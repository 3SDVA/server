--source include/galera_cluster.inc

# Save original auto_increment_offset values.
--let $node_1=node_1
--let $node_2=node_2
--source include/auto_increment_offset_save.inc

--connection node_2
call mtr.add_suppression("WSREP:.*Invalid backend URI: a");
call mtr.add_suppression("WSREP: gcs connect failed: Invalid argument");
--let $wsrep_cluster_address_orig = `SELECT @@wsrep_cluster_address`

--echo # This will cause separation from cluster

--error ER_WRONG_VALUE_FOR_VAR
SET GLOBAL wsrep_cluster_address='a';
--error ER_WRONG_ARGUMENTS
SET GLOBAL wsrep_slave_threads=0;

SET SESSION wsrep_sync_wait=0;
SHOW STATUS LIKE 'wsrep_ready';
SHOW STATUS LIKE 'wsrep_cluster_status';
SHOW STATUS LIKE 'wsrep_local_state';
SHOW STATUS LIKE 'wsrep_local_state_comment';

--echo # Join back to cluster

--disable_query_log
--eval SET GLOBAL wsrep_cluster_address = '$wsrep_cluster_address_orig';
--enable_query_log

--source include/wait_until_connected_again.inc

SHOW STATUS LIKE 'wsrep_ready';
SHOW STATUS LIKE 'wsrep_cluster_status';
SHOW STATUS LIKE 'wsrep_local_state';
SHOW STATUS LIKE 'wsrep_local_state_comment';

SET SESSION wsrep_on=OFF;
--error ER_WRONG_ARGUMENTS
SET GLOBAL wsrep_slave_threads=2;
SELECT @@wsrep_slave_threads;
