--source include/have_innodb.inc
set global innodb_monitor_disable = All;
set global innodb_monitor_enable = all;

select name from information_schema.innodb_metrics where not enabled;


CREATE TABLE t1(id INT PRIMARY KEY, a INT, b CHAR(1), UNIQUE KEY u(a,b))
ENGINE=InnoDB;

BEGIN;
INSERT INTO t1 VALUES(1,1,'a'),(2,9999,'b'),(3,10000,'c'),(4,4,'d');
DELETE FROM t1 WHERE a = 9999 AND b='b';
COMMIT;

SET @start = (SELECT COUNT FROM INFORMATION_SCHEMA.INNODB_METRICS WHERE NAME
= 'lock_rec_lock_created');

BEGIN;
LOCK TABLE t1 WRITE;
SELECT * FROM t1 FOR UPDATE;
SELECT * FROM t1 WHERE a>=10000 FOR UPDATE;
DELETE FROM t1;
COMMIT;
UNLOCK TABLES;

SET @end = (SELECT COUNT FROM INFORMATION_SCHEMA.INNODB_METRICS WHERE NAME = 'lock_rec_lock_created');
SELECT @end - @start;


SET GLOBAL innodb_monitor_enable=default;
SET GLOBAL innodb_monitor_disable=default;
SET GLOBAL innodb_monitor_reset_all=default;
DROP TABLE t1;

