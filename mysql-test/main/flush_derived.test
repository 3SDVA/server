--source include/have_perfschema.inc

--echo #
--echo # MDEV-25906: SIGSEGV in flush_tables_with_read_lock on FTWRL
--echo # or FTFE | SIGSEGV in ha_maria::extra
--echo #
CREATE VIEW v0 AS SELECT 1;
CREATE VIEW v1 AS SELECT 1 FROM (SELECT 1) AS d;
CREATE VIEW v2 AS SELECT * FROM v1;
CREATE VIEW v3 AS SELECT * FROM information_schema.collations;
CREATE VIEW v4 AS SELECT * FROM performance_schema.accounts;
CREATE VIEW v5 AS SELECT * FROM information_schema.COLUMNS;
FLUSH TABLE v0 WITH READ LOCK;
--error ER_LOCK_OR_ACTIVE_TRANSACTION
DROP VIEW v0;
UNLOCK TABLES;
FLUSH TABLE v1 WITH READ LOCK;
--error ER_LOCK_OR_ACTIVE_TRANSACTION
DROP VIEW v1;
UNLOCK TABLES;
FLUSH TABLE v2 WITH READ LOCK;
--error ER_LOCK_OR_ACTIVE_TRANSACTION
DROP VIEW v2;
UNLOCK TABLES;
FLUSH TABLE v3 WITH READ LOCK;
--error ER_LOCK_OR_ACTIVE_TRANSACTION
DROP VIEW v3;
UNLOCK TABLES;
FLUSH TABLE v4 WITH READ LOCK;
--error ER_LOCK_OR_ACTIVE_TRANSACTION
DROP VIEW v4;
UNLOCK TABLES;
FLUSH TABLE v5 WITH READ LOCK;
--error ER_LOCK_OR_ACTIVE_TRANSACTION
DROP VIEW v5;
UNLOCK TABLES;
FLUSH TABLE v0 FOR EXPORT;
--error ER_LOCK_OR_ACTIVE_TRANSACTION
DROP VIEW v0;
UNLOCK TABLES;
FLUSH TABLE v1 FOR EXPORT;
--error ER_LOCK_OR_ACTIVE_TRANSACTION
DROP VIEW v1;
UNLOCK TABLES;
FLUSH TABLE v2 FOR EXPORT;
--error ER_LOCK_OR_ACTIVE_TRANSACTION
DROP VIEW v2;
UNLOCK TABLES;
--error ER_ILLEGAL_HA
FLUSH TABLE v3 FOR EXPORT;
--error ER_ILLEGAL_HA
FLUSH TABLE v4 FOR EXPORT;
--error ER_ILLEGAL_HA
FLUSH TABLE v5 FOR EXPORT;
DROP VIEW v2, v1, v0, v3, v4, v5;

--echo # End of 10.6 tests
